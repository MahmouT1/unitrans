===============================================
حل سريع لمشكلة Student Search - أوامر مباشرة
===============================================

📋 نسخ الأوامر وتنفيذها واحدة تلو الأخرى على السيرفر:

-------------------
الخطوة 1: الذهاب لمجلد المشروع
-------------------
cd /var/www/unitrans

-------------------
الخطوة 2: إنشاء ملف API المفقود
-------------------
mkdir -p frontend-new/app/api/students/all

cat > frontend-new/app/api/students/all/route.js << 'EOF'
import { NextResponse } from 'next/server';

export async function GET(request) {
  try {
    const { searchParams } = new URL(request.url);
    const page = searchParams.get('page') || '1';
    const limit = searchParams.get('limit') || '20';
    const search = searchParams.get('search') || '';
    
    const backendUrl = process.env.BACKEND_URL || 'http://localhost:3001';
    const params = new URLSearchParams({
      page,
      limit,
      ...(search && { search })
    });
    
    console.log(`📡 Proxying request to backend: ${backendUrl}/api/students/all?${params}`);
    
    const backendResponse = await fetch(`${backendUrl}/api/students/all?${params}`, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    });
    
    const data = await backendResponse.json();
    
    if (!backendResponse.ok) {
      console.error('❌ Backend error:', data);
      return NextResponse.json(data, { status: backendResponse.status });
    }
    
    console.log(`✅ Successfully fetched ${data.students?.length || 0} students`);
    
    return NextResponse.json(data, { status: 200 });
    
  } catch (error) {
    console.error('❌ Error fetching students:', error);
    return NextResponse.json(
      { 
        success: false, 
        message: 'Failed to fetch students', 
        error: error.message 
      },
      { status: 500 }
    );
  }
}
EOF

echo "✅ ملف API تم إنشاؤه"

-------------------
الخطوة 3: التحقق من MongoDB
-------------------
systemctl status mongod

# إذا لم يكن يعمل، شغله:
sudo systemctl start mongod

-------------------
الخطوة 4: إعادة بناء Frontend
-------------------
cd /var/www/unitrans/frontend-new
npm run build

-------------------
الخطوة 5: إعادة تشغيل الخدمات
-------------------
# إذا كنت تستخدم PM2:
pm2 restart all
pm2 save
pm2 logs

# أو إذا كنت تستخدم systemd:
sudo systemctl restart unitrans-backend
sudo systemctl restart unitrans-frontend

-------------------
الخطوة 6: اختبار الحل
-------------------
# اختبر Backend
curl http://localhost:3001/api/students/all?page=1&limit=20

# اختبر Frontend
curl http://localhost:3000/api/students/all?page=1&limit=20

-------------------
✅ انتهى! 
-------------------

الآن:
1. افتح المتصفح
2. اذهب لصفحة Student Search
3. اضغط F12 لفتح Console
4. اضغط Refresh
5. يجب أن ترى الطلاب يظهرون من قاعدة البيانات ✅

-------------------
إذا واجهت مشاكل:
-------------------
# شاهد اللوجات:
pm2 logs

# تحقق من MongoDB:
mongo
> use student_portal
> db.students.count()
> exit

# تحقق من Nginx:
sudo nginx -t
sudo systemctl status nginx

===============================================
