#!/bin/bash

# =================================================
# ๐ ูุดุฑ ุงูุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ ุนูู ุณูุฑูุฑ ุงูุฏูููู
# =================================================

echo "๐ ุจุฏุก ูุดุฑ ุงูุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ..."

# 1๏ธโฃ ุณุญุจ ุขุฎุฑ ุงูุชุญุฏูุซุงุช ูู GitHub
echo "๐ฅ ุณุญุจ ุขุฎุฑ ุงูุชุญุฏูุซุงุช ูู GitHub..."
cd /var/www/unitrans
git pull origin main

# 2๏ธโฃ ุชุซุจูุช ุงูููุชุจุงุช ุงูุฌุฏูุฏุฉ ูู Backend
echo "๐ฆ ุชุซุจูุช ุงูููุชุจุงุช ุงูุฌุฏูุฏุฉ ูู Backend..."
cd backend-new
npm install qrcode
cd ..

# 3๏ธโฃ ุฅุนุงุฏุฉ ุชุดุบูู Backend
echo "๐ ุฅุนุงุฏุฉ ุชุดุบูู Backend..."
pm2 restart unitrans-backend

# 4๏ธโฃ ุจูุงุก Frontend ูุน ุงูุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ
echo "๐จ ุจูุงุก Frontend ูุน ุงูุชุญุฏูุซุงุช..."
cd frontend-new
rm -rf .next
npm run build
cd ..

# 5๏ธโฃ ุฅุนุงุฏุฉ ุชุดุบูู Frontend
echo "๐ ุฅุนุงุฏุฉ ุชุดุบูู Frontend..."
pm2 restart unitrans-frontend

# 6๏ธโฃ ูุญุต ุญุงูุฉ ุงูุฎุฏูุงุช
echo "๐ ูุญุต ุญุงูุฉ ุงูุฎุฏูุงุช..."
pm2 status

# 7๏ธโฃ ุงุฎุชุจุงุฑ ุงูู APIs ุงูุฌุฏูุฏุฉ
echo "๐งช ุงุฎุชุจุงุฑ ุงูู APIs ุงูุฌุฏูุฏุฉ..."
echo "๐ ุงุฎุชุจุงุฑ API ุชุณุฌูู ุงูุทูุงุจ:"
curl -X GET https://unibus.online:3001/api/students/all?page=1&limit=5

echo ""
echo "๐ ุงุฎุชุจุงุฑ API ุงูุญุถูุฑ:"
curl -X GET https://unibus.online:3001/api/attendance/all-records

echo ""
echo "๐ ุงุฎุชุจุงุฑ ุงูุตุญุฉ ุงูุนุงูุฉ:"
curl -X GET https://unibus.online:3001/health

echo ""
echo "โ ุชู ูุดุฑ ุฌููุน ุงูุชุญุฏูุซุงุช ุจูุฌุงุญ!"
echo "๐ ููููู ุงูุขู ุงุฎุชุจุงุฑ ุงููุธุงู ุนูู: https://unibus.online"
echo ""
echo "๐ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:"
echo "  - โ ุชุณุฌูู ุทูุงุจ ุฌุฏูุฏ ูุน QR Code"
echo "  - โ ุชุชุจุน ุนุฏุฏ ุฃูุงู ุงูุญุถูุฑ ุชููุงุฆูุงู"
echo "  - โ ุนุฑุถ ุจูุงูุงุช ุงูุญุถูุฑ ูู ุงูุจุญุซ"
echo "  - โ APIs ูุญุณูุฉ ููุทูุงุจ ูุงูุญุถูุฑ"
